#!/usr/bin/env bash

# https://www.vagrantup.com/docs/providers/virtualbox/boxes.html
# https://www.vagrantup.com/docs/boxes/base

sudo apt-get install linux-headers-$(uname -r) build-essential dkms

sudo mount /dev/cdrom /media/cdrom

sudo sh /media/cdrom/VBoxLinuxAdditions.run

useradd vagrant -m -s /bin/bash
printf 'vagrant\nvagrant' | sudo passwd vagrant

sudo su - vagrant -c "ssh-keygen -f ~/.ssh/id_vagrant -N ''"

sudo su - vagrant -c "curl -o ~/.ssh/authorized_keys https://raw.githubusercontent.com/hashicorp/vagrant/master/keys/vagrant.pub"

sudo su - -c "echo 'vagrant ALL=(ALL) NOPASSWD: ALL' > /etc/sudoers.d/vagrant"

sudo dd if=/dev/zero of=/erase_me bs=100M || sudo rm erase_me